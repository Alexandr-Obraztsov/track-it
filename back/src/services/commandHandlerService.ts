import TelegramBot = require('node-telegram-bot-api')
import { TaskService } from './taskService'
import { ChatService } from './chatService'
import { RoleService } from './roleService'

// –°–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ Telegram
export class CommandHandlerService {
    private taskService: TaskService
    private chatService: ChatService
    private roleService: RoleService

    constructor(taskService: TaskService, chatService: ChatService, roleService: RoleService) {
        this.taskService = taskService
        this.chatService = chatService
        this.roleService = roleService
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
    async handleStart(bot: TelegramBot, msg: any): Promise<void> {
        const chatId = msg.chat.id.toString()
        const isGroup = msg.chat.type === 'group' || msg.chat.type === 'supergroup'

        if (isGroup) {
            const welcomeText = '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ –≤ –≥—Ä—É–ø–ø–∞—Ö.\n\n' +
                'üéôÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è:\n' +
                '‚Ä¢ –°–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á\n' +
                '‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏\n' +
                '‚Ä¢ –†–∞–±–æ—Ç—ã —Å —Ä–æ–ª—è–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n' +
                '‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏\n\n' +
                '‚ÑπÔ∏è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!\n' +
                'ü§ñ –í—Å–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏ –ò–ò!'
            
            bot.sendMessage(chatId, welcomeText)
        } else {
            bot.sendMessage(chatId, '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏.\n\nüéôÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —Å –ø–æ–º–æ—â—å—é –ò–ò!')
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /help
    async handleHelp(bot: TelegramBot, msg: any): Promise<void> {
        const chatId = msg.chat.id.toString()
        const isGroup = msg.chat.type === 'group' || msg.chat.type === 'supergroup'

        if (isGroup) {
            const helpText = 'ü§ñ –ë–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —á–µ—Ä–µ–∑ –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã\n\n' +
                'üéôÔ∏è –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≥–æ–ª–æ—Å–æ–º:\n\n' +
                'üìù –°–û–ó–î–ê–ù–ò–ï –ó–ê–î–ê–ß:\n' +
                '‚Ä¢ "–°–æ–∑–¥–∞–π –∑–∞–¥–∞—á—É –Ω–∞–ø–∏—Å–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"\n' +
                '‚Ä¢ "–î–æ–±–∞–≤—å –∑–∞–¥–∞—á—É –Ω–∞ –ü–µ—Ç—é - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"\n' +
                '‚Ä¢ "–°–¥–µ–ª–∞—Ç—å –¥–∏–∑–∞–π–Ω –¥–æ –∑–∞–≤—Ç—Ä–∞, –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç"\n\n' +
                'üìã –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–î–ê–ß–ê–ú–ò:\n' +
                '‚Ä¢ "–ü–æ–∫–∞–∂–∏ –≤—Å–µ –∑–∞–¥–∞—á–∏"\n' +
                '‚Ä¢ "–£–¥–∞–ª–∏ –∑–∞–¥–∞—á—É –Ω–æ–º–µ—Ä 3"\n' +
                '‚Ä¢ "–û—Ç–º–µ—Ç—å –∑–∞–¥–∞—á—É 5 –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é"\n' +
                '‚Ä¢ "–ù–∞–∑–Ω–∞—á—å –∑–∞–¥–∞—á—É 2 –Ω–∞ –ú–∞—à—É"\n\n' +
                'üë• –†–ê–ë–û–¢–ê –° –†–û–õ–Ø–ú–ò:\n' +
                '‚Ä¢ "–°–æ–∑–¥–∞–π —Ä–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫"\n' +
                '‚Ä¢ "–ù–∞–∑–Ω–∞—á—å –ò–≤–∞–Ω—É —Ä–æ–ª—å –∞–¥–º–∏–Ω"\n' +
                '‚Ä¢ "–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤"\n' +
                '‚Ä¢ "–ö–∞–∫–∏–µ —Ä–æ–ª–∏ –µ—Å—Ç—å?"\n\n' +
                '‚ú® –ü—Ä–æ—Å—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ - –ò–ò –ø–æ–π–º–µ—Ç –≤–∞—à–∏ –∫–æ–º–∞–Ω–¥—ã!'
            
            bot.sendMessage(chatId, helpText)
        } else {
            bot.sendMessage(chatId, 'ü§ñ –ë–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏\n\nüéôÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —Å –ø–æ–º–æ—â—å—é –ò–ò!\n\n–ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥:\n‚Ä¢ "–°–æ–∑–¥–∞–π –∑–∞–¥–∞—á—É –∫—É–ø–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã"\n‚Ä¢ "–ü–æ–∫–∞–∂–∏ –º–æ–∏ –∑–∞–¥–∞—á–∏"\n‚Ä¢ "–û—Ç–º–µ—Ç—å –∑–∞–¥–∞—á—É 1 –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é"')
        }
    }

}